{"version":3,"sources":["skylark-langx-events.js"],"names":["define","skylark","attach","objects","funcs","klass","eventMethods","preventDefault","stopImmediatePropagation","stopPropagation","compatible","event","source","isDefaultPrevented","each","name","predicate","sourceMethod","this","returnTrue","apply","arguments","returnFalse","Event","CustomEvent","[object Object]","type","props","super","safeMixin","types","arrays","events","Array","prototype","slice","compact","isString","isDefined","isPlainObject","isFunction","isEmptyObject","Handler","mixin","listenTo","obj","callback","one","on","listening","listeningTo","_listeningTo","i","length","push","listeningEvents","listeningEvent","indexOf","listenToOnce","unlistenTo","eventName","j","off","parse","segs","split","ns","join","Emitter","inherit","selector","data","ctx","self","_hub","fn","undefined","forEach","parsed","emit","e","Object","defineProperty","value","args","call","concat","listeners","len","reCompact","isImmediatePropagationStopped","listener","startsWith","listened","evtArr","_events","evts","liveEvents","_","trigger","createEvent","main"],"mappings":"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","file":"../skylark-langx-events.js","sourcesContent":["define('skylark-langx-events/events',[\r\n\t\"skylark-langx-ns\"\r\n],function(skylark){\r\n\treturn skylark.attach(\"langx.events\",{});\r\n});\ndefine('skylark-langx-events/Event',[\r\n  \"skylark-langx-objects\",\r\n  \"skylark-langx-funcs\",\r\n  \"skylark-langx-klass\",\r\n],function(objects,funcs,klass){\r\n    var eventMethods = {\r\n        preventDefault: \"isDefaultPrevented\",\r\n        stopImmediatePropagation: \"isImmediatePropagationStopped\",\r\n        stopPropagation: \"isPropagationStopped\"\r\n     };\r\n        \r\n\r\n    function compatible(event, source) {\r\n        if (source || !event.isDefaultPrevented) {\r\n            if (!source) {\r\n                source = event;\r\n            }\r\n\r\n            objects.each(eventMethods, function(name, predicate) {\r\n                var sourceMethod = source[name];\r\n                event[name] = function() {\r\n                    this[predicate] = funcs.returnTrue;\r\n                    return sourceMethod && sourceMethod.apply(source, arguments);\r\n                }\r\n                event[predicate] = funcs.returnFalse;\r\n            });\r\n        }\r\n        return event;\r\n    }\r\n\r\n\r\n    /*\r\n    var Event = klass({\r\n        _construct : function(type,props) {\r\n            CustomEvent.call(this,type.props);\r\n            objects.safeMixin(this, props);\r\n            compatible(this);\r\n        }\r\n    },CustomEvent);\r\n    */\r\n\r\n    class Event extends CustomEvent {\r\n        constructor(type,props) {\r\n            super(type,props);\r\n            objects.safeMixin(this, props);\r\n            compatible(this);\r\n        } \r\n    }\r\n\r\n\r\n    Event.compatible = compatible;\r\n\r\n    return Event;\r\n    \r\n});\ndefine('skylark-langx-events/Handler',[\r\n  \"skylark-langx-types\",\r\n  \"skylark-langx-objects\",\r\n  \"skylark-langx-arrays\",\r\n  \"skylark-langx-klass\",\r\n  \"./events\",\r\n  \"./Event\"\r\n],function(types,objects,arrays,klass,events,Event){\r\n    var slice = Array.prototype.slice,\r\n        compact = arrays.compact,\r\n        isDefined = types.isDefined,\r\n        isPlainObject = types.isPlainObject,\r\n        isFunction = types.isFunction,\r\n        isString = types.isString,\r\n        isEmptyObject = types.isEmptyObject,\r\n        mixin = objects.mixin,\r\n        safeMixin = objects.safeMixin;\r\n\r\n\r\n    var Handler = klass({\r\n\r\n        listenTo: function(obj, event, callback, /*used internally*/ one) {\r\n            if (!obj) {\r\n                return this;\r\n            }\r\n\r\n            // Bind callbacks on obj,\r\n            if (isString(callback)) {\r\n                callback = this[callback];\r\n            }\r\n\r\n            if (one) {\r\n                obj.one(event, callback, this);\r\n            } else {\r\n                obj.on(event, callback, this);\r\n            }\r\n\r\n            //keep track of them on listening.\r\n            var listeningTo = this._listeningTo || (this._listeningTo = []),\r\n                listening;\r\n\r\n            for (var i = 0; i < listeningTo.length; i++) {\r\n                if (listeningTo[i].obj == obj) {\r\n                    listening = listeningTo[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (!listening) {\r\n                listeningTo.push(\r\n                    listening = {\r\n                        obj: obj,\r\n                        events: {}\r\n                    }\r\n                );\r\n            }\r\n            var listeningEvents = listening.events,\r\n                listeningEvent = listeningEvents[event] = listeningEvents[event] || [];\r\n            if (listeningEvent.indexOf(callback) == -1) {\r\n                listeningEvent.push(callback);\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        listenToOnce: function(obj, event, callback) {\r\n            return this.listenTo(obj, event, callback, 1);\r\n        },\r\n\r\n        unlistenTo: function(obj, event, callback) {\r\n            var listeningTo = this._listeningTo;\r\n            if (!listeningTo) {\r\n                return this;\r\n            }\r\n            for (var i = 0; i < listeningTo.length; i++) {\r\n                var listening = listeningTo[i];\r\n\r\n                if (obj && obj != listening.obj) {\r\n                    continue;\r\n                }\r\n\r\n                var listeningEvents = listening.events;\r\n                for (var eventName in listeningEvents) {\r\n                    if (event && event != eventName) {\r\n                        continue;\r\n                    }\r\n\r\n                    var listeningEvent = listeningEvents[eventName];\r\n\r\n                    for (var j = 0; j < listeningEvent.length; j++) {\r\n                        if (!callback || callback == listeningEvent[i]) {\r\n                            listening.obj.off(eventName, listeningEvent[i], this);\r\n                            listeningEvent[i] = null;\r\n                        }\r\n                    }\r\n\r\n                    listeningEvent = listeningEvents[eventName] = compact(listeningEvent);\r\n\r\n                    if (isEmptyObject(listeningEvent)) {\r\n                        listeningEvents[eventName] = null;\r\n                    }\r\n\r\n                }\r\n\r\n                if (isEmptyObject(listeningEvents)) {\r\n                    listeningTo[i] = null;\r\n                }\r\n            }\r\n\r\n            listeningTo = this._listeningTo = compact(listeningTo);\r\n            if (isEmptyObject(listeningTo)) {\r\n                this._listeningTo = null;\r\n            }\r\n\r\n            return this;\r\n        }\r\n    });\r\n\r\n    return events.Handler = Handler;\r\n\r\n});\ndefine('skylark-langx-events/Emitter',[\r\n  \"skylark-langx-types\",\r\n  \"skylark-langx-objects\",\r\n  \"skylark-langx-arrays\",\r\n  \"skylark-langx-klass\",\r\n  \"./events\",\r\n  \"./Event\",\r\n  \"./Handler\"\r\n],function(types,objects,arrays,klass,events,Event,Handler){\r\n    var slice = Array.prototype.slice,\r\n        compact = arrays.compact,\r\n        isDefined = types.isDefined,\r\n        isPlainObject = types.isPlainObject,\r\n        isFunction = types.isFunction,\r\n        isString = types.isString,\r\n        isEmptyObject = types.isEmptyObject,\r\n        mixin = objects.mixin,\r\n        safeMixin = objects.safeMixin;\r\n\r\n    function parse(event) {\r\n        var segs = (\"\" + event).split(\".\");\r\n        return {\r\n            name: segs[0],\r\n            ns: segs.slice(1).join(\" \")\r\n        };\r\n    }\r\n\r\n    var Emitter = Handler.inherit({\r\n        on: function(events, selector, data, callback, ctx, /*used internally*/ one) {\r\n            var self = this,\r\n                _hub = this._hub || (this._hub = {});\r\n\r\n            if (isPlainObject(events)) {\r\n                ctx = callback;\r\n                each(events, function(type, fn) {\r\n                    self.on(type, selector, data, fn, ctx, one);\r\n                });\r\n                return this;\r\n            }\r\n\r\n            if (!isString(selector) && !isFunction(callback)) {\r\n                ctx = callback;\r\n                callback = data;\r\n                data = selector;\r\n                selector = undefined;\r\n            }\r\n\r\n            if (isFunction(data)) {\r\n                ctx = callback;\r\n                callback = data;\r\n                data = null;\r\n            }\r\n\r\n            if (isString(events)) {\r\n                events = events.split(/\\s/)\r\n            }\r\n\r\n            events.forEach(function(event) {\r\n                var parsed = parse(event),\r\n                    name = parsed.name,\r\n                    ns = parsed.ns;\r\n\r\n                (_hub[name] || (_hub[name] = [])).push({\r\n                    fn: callback,\r\n                    selector: selector,\r\n                    data: data,\r\n                    ctx: ctx,\r\n                    ns : ns,\r\n                    one: one\r\n                });\r\n            });\r\n\r\n            return this;\r\n        },\r\n\r\n        one: function(events, selector, data, callback, ctx) {\r\n            return this.on(events, selector, data, callback, ctx, 1);\r\n        },\r\n\r\n        emit: function(e /*,argument list*/ ) {\r\n            if (!this._hub) {\r\n                return this;\r\n            }\r\n\r\n            var self = this;\r\n\r\n            if (isString(e)) {\r\n                e = new Event(e); //new CustomEvent(e);\r\n            }\r\n\r\n            Object.defineProperty(e,\"target\",{\r\n                value : this\r\n            });\r\n\r\n            var args = slice.call(arguments, 1);\r\n            if (isDefined(args)) {\r\n                args = [e].concat(args);\r\n            } else {\r\n                args = [e];\r\n            }\r\n            [e.type || e.name, \"all\"].forEach(function(eventName) {\r\n                var parsed = parse(eventName),\r\n                    name = parsed.name,\r\n                    ns = parsed.ns;\r\n\r\n                var listeners = self._hub[name];\r\n                if (!listeners) {\r\n                    return;\r\n                }\r\n\r\n                var len = listeners.length,\r\n                    reCompact = false;\r\n\r\n                for (var i = 0; i < len; i++) {\r\n                    if (e.isImmediatePropagationStopped && e.isImmediatePropagationStopped()) {\r\n                        return this;\r\n                    }\r\n                    var listener = listeners[i];\r\n                    if (ns && (!listener.ns ||  !listener.ns.startsWith(ns))) {\r\n                        continue;\r\n                    }\r\n                    if (e.data) {\r\n                        if (listener.data) {\r\n                            e.data = mixin({}, listener.data, e.data);\r\n                        }\r\n                    } else {\r\n                        e.data = listener.data || null;\r\n                    }\r\n                    listener.fn.apply(listener.ctx, args);\r\n                    if (listener.one) {\r\n                        listeners[i] = null;\r\n                        reCompact = true;\r\n                    }\r\n                }\r\n\r\n                if (reCompact) {\r\n                    self._hub[eventName] = compact(listeners);\r\n                }\r\n\r\n            });\r\n            return this;\r\n        },\r\n\r\n        listened: function(event) {\r\n            var evtArr = ((this._hub || (this._events = {}))[event] || []);\r\n            return evtArr.length > 0;\r\n        },\r\n\r\n        off: function(events, callback) {\r\n            var _hub = this._hub || (this._hub = {});\r\n            if (isString(events)) {\r\n                events = events.split(/\\s/)\r\n            }\r\n\r\n            events.forEach(function(event) {\r\n                var parsed = parse(event),\r\n                    name = parsed.name,\r\n                    ns = parsed.ns;\r\n\r\n                var evts = _hub[name];\r\n\r\n                if (evts) {\r\n                    var liveEvents = [];\r\n\r\n                    if (callback || ns) {\r\n                        for (var i = 0, len = evts.length; i < len; i++) {\r\n                            \r\n                            if (callback && evts[i].fn !== callback && evts[i].fn._ !== callback) {\r\n                                liveEvents.push(evts[i]);\r\n                                continue;\r\n                            } \r\n\r\n                            if (ns && (!evts[i].ns || evts[i].ns.indexOf(ns)!=0)) {\r\n                                liveEvents.push(evts[i]);\r\n                                continue;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (liveEvents.length) {\r\n                        _hub[name] = liveEvents;\r\n                    } else {\r\n                        delete _hub[name];\r\n                    }\r\n\r\n                }\r\n            });\r\n\r\n            return this;\r\n        },\r\n        trigger  : function() {\r\n            return this.emit.apply(this,arguments);\r\n        }\r\n    });\r\n\r\n\r\n    return　events.Emitter = Emitter;\r\n\r\n});\ndefine('skylark-langx-events/createEvent',[\r\n\t\"./events\",\r\n\t\"./Event\"\r\n],function(events,Event){\r\n    function createEvent(type,props) {\r\n        //var e = new CustomEvent(type,props);\r\n        //return safeMixin(e, props);\r\n        return new Event(type,props);\r\n    };\r\n\r\n    return events.createEvent = createEvent;\t\r\n});\ndefine('skylark-langx-events/main',[\r\n\t\"./events\",\r\n\t\"./Event\",\r\n\t\"./Handler\",\r\n\t\"./Emitter\",\r\n\t\"./createEvent\"\r\n],function(events){\r\n\treturn events;\r\n});\ndefine('skylark-langx-events', ['skylark-langx-events/main'], function (main) { return main; });\n\n"]}